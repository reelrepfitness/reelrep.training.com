"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[240],{6643:(e,t,n)=>{var o=n(9420),a=n.n(o),s=n(6942),r=n(1714),l=n(545),i=n(1738),c=n(8083),d=n(2338),u=n(6677),m=n(2880),g=n(4183),h=n(7587);const{options:p,isMobile:f,currentStepEl:A,nameForSessionVisited:b,nameForSessionCoaches:v,classTypeElName:y}=h.A;let S=!1;const C=function(){if(S)return!1;document.addEventListener("click",function(e){for(let t=e.target;t&&t!=this;t=t.parentNode){if(t.matches(".js--toggle-with-text")){e.preventDefault();const n=t.querySelector(".btn--dropdown-arrow");if(null===n)return!1;const o=t.nextElementSibling;s.A.slideToggle(o),s.A.toggleClass(n,"opened");const a=n.querySelector("span");a&&(n.getAttribute("data-opened")||n.getAttribute("data-closed"))&&(a.textContent=n.getAttribute(n.classList.contains("opened")?"data-opened":"data-closed"));break}if(t.matches(".js--meeting-bar")){e.preventDefault(),D.call(this,t,e);break}if(t.matches(".btn--go-to")){e.preventDefault();const n=t.getAttribute("data-to");let o=null;if(n.indexOf("#name_")>-1){const[e,t]=n.replace("#name_","").split("|"),a=document.querySelector('[name="'+e+'"][value="'+t+'"]');null!==a&&(a.checked=!0,(0,r.rC)(a,"change")),o=document.querySelector(".js--chosen-coach")}else if(n.indexOf("#step_")>-1){let e=null,t=n.replace("#step_","");t.indexOf("_")>-1&&([t,e]=t.split("_"));const o=parseInt(t),a=s.A.getCurrentStep();if("return"===A.getAttribute("data-current-step")){if(1===o&&p.requestData.classStudioDateIds)return p.helpData.deleteAfterReservationHasPassed=!0,s.A.requestToDeleteReservation().then(function(){s.A.updateStep1AndMoveTo()}),!1;2===o&&(p.helpData.sendCoaches=!0,d.n.init())}s.A.moveToStep(a,o,e)}else n.indexOf("#date")>-1&&(o=document.querySelector('[href="'+n+'"]'),null===o&&d.n.sliderEndRequest({nextDay:n.replace("#date",""),withClick:!0}));null!==o&&o.click();break}if(t.matches(".js--selected_remove")){e.preventDefault();const n=s.A.getCurrentStep();c.g.selectedRemove.call(this,t,e),n>2&&p.requestData.classStudioDateIds&&(p.helpData.deleteAfterReservationHasPassed=!0),0===document.querySelectorAll(`[name="${y}"]:checked`).length?s.A.requestToDeleteReservation().then(function(){1!==n&&(delete p.requestData.classTypeId,s.A.updateStep1AndMoveTo())}):2===n?(p.helpData.sendCoaches=!0,d.n.init()):3===n?u.u.init():4===n&&m.B.init();break}if(t.matches(".js--selected-time")){if(e.preventDefault(),!k(t))return!1;break}if(t.matches("#chooseQuickOrder")){e.preventDefault();const t=document.querySelector('[name="quickOrder"]:checked');if(!t||!k(t))return!1;break}if(t.matches(".js--chosen-time-coach")){e.preventDefault();const n=s.A.getCheckedValues("coachTimeId","value");if(""===n)return s.A.addClass(document.querySelectorAll('[name="coachTimeId"]'),"error"),!1;p.requestData=Object.assign({},p.requestData,{coachId:n}),i.a.close(t.closest(".bsapp--modal")),T();break}if(t.matches(".js--assign-client-to-meeting")){e.preventDefault();const n=document.getElementById("userCardNewIframe");n&&(n.classList.remove("loading"),n.classList.remove("loading-after-iframe")),s.A.bodyPreload(!0),s.A.paymentPageInit(t.getAttribute("data-orderId"));break}if(t.matches(".js--try-again-get-iframe")){e.preventDefault(),s.A.showErrorModal(t.getAttribute("data-text")),g.g.sendRequest();break}}},!1),document.getElementById("toPreviousStep").addEventListener("click",function(e){e.preventDefault();let t=s.A.getCurrentStep(),n=t-1;5===t?null===document.querySelector(".modal-dialog__subscription-order")&&(n=t-2):4===t&&(3===n&&(n=t-2,t=3,console.log("6"),i.a.close("themeModal--swiperMobile")),null!==document.querySelector(".meeting--big-cost")&&document.querySelector(".meeting--big-cost").textContent!==s.A.getTotalCost()&&(document.querySelector(".meeting--big-cost").textContent=s.A.getTotalCost())),3===t&&2===n&&(p.helpData.deleteAfterReservationHasPassed=!0,p.requestData.classStudioDateIds?s.A.requestToDeleteReservation().then(function(){p.helpData.sendCoaches=!0,d.n.init()}):(p.helpData.sendCoaches=!0,d.n.init())),s.A.moveToStep(t,n)}),S||(S=!0)},D=function(e,t){const n=s.A.getCurrentStep();1===n&&(p.helpData.sendCoaches=!0,d.n.init(),s.A.moveToStep(n,n+1))},k=function(e){const t=e.getAttribute("data-coach-id");if(!t||""===t)return!1;if(p.requestData=Object.assign({},p.requestData,{coachId:t,date:e.getAttribute("data-date"),time:e.getAttribute("data-time"),breakTime:e.getAttribute("data-preparation")}),t.indexOf(",")>-1){const e=t.split(","),n=s.A.getSessionStorage(v),o=(null!==n?n:[]).filter(t=>e.includes(t.id));return 0===o.length||(d.n.createCoachModal({allCoaches:o,elId:"bsappModal--coaches_time",isOpen:!0}),console.log("7"),i.a.close("themeModal--swiperMobile")),!1}T()},T=function(){i.a.close("themeModal--swiperMobile"),u.u.init()},q=function({step:e,reservedTimer:t,classTypeId:n,totalPrice:o,studioAllowFullPrePayment:a,studioAutoApproval:l}){const i=document.getElementById("meetingsTab");i&&i.click(),p.helpData.totalPrice=o,p.helpData.returnedFromCart=!0;const c=s.A.getSessionStorage(v);if(null!==c&&d.n.createCoachHTML(c),document.querySelectorAll(`[name="${y}"]`).length>0){const e=n.split(",").map(e=>document.getElementById(y+e));s.A.setCheckedProp(e,!0)}s.A.moveToStep(1,e);const g=(0,r.h0)(t);p.helpData.studioAllowFullPrePayment=a,p.helpData.studioAutoApproval=l,u.u.init(g),4===e&&g&&g>0&&(s.A.compileDateTime(p.requestData.date,p.requestData.time),m.B.init()),s.A.bodyPreload(!1),s.A.removeClass(document.getElementById("preloader"),"full-bg"),sessionStorage.removeItem(b)};var w=n(2228),I=n(3522),E=n(6623);const{isMobile:B,classTypeElName:P,controllerUrl:M}=h.A,L=async function(){const e=(0,r._y)();e&&(0,E.Z)();const t=s.A.getParamGetUrl(),n=window.location.pathname,o="/meetings.php",i="/lessons.php";a().locale((0,r.JK)()??document.documentElement.lang),a().relativeTimeThreshold("m",60),a().relativeTimeThreshold("h",24),a().updateLocale("he",{relativeTime:{mm:"%d דק׳"}}),s.A.commonEventListener();const d=document.querySelectorAll('[data-toggle="tab"]');let u=s.A.getSearchParam("tab");const{haveMeetings:m,haveLessons:g}=await(0,l.HH)();if(!e&&(!m&&n===o||!g&&n===i))return window.location.href=`/meeting-booking.php?GetUrl=${t}`,!1;if(!m&&!g){u&&s.A.deleteSearchParam("tab");const e=document.getElementById("infoTab");e&&s.A.addClass(e,"d-none"),document.body.clientHeight<window.innerHeight&&(s.A.addClass(document.body,"footer-to-bottom"),s.A.addClass(document.documentElement,"h--100")),s.A.showErrorModal("לא נמצאו אירועים לבחירה")}d.length>0&&j(m,g);try{const e=[];if(m&&n!==i||!m&&n===o)e.push(async function(){const e=s.A.getSessionStorage(b),t=null!==e&&("meetings"===e.tab||"/meetings.php"===e.pathname)&&void 0!==e.classTypeId&&null!==e.classTypeId;t&&(p.requestData=Object.assign({},p.requestData,e)),await c.g.fetchMeetings(t?function(){q(e)}:null),C()}());else if("meetings"===u){s.A.deleteSearchParam("tab"),s.A.removeClass(document.getElementById("meetings"),"active");const e=document.getElementById((B.matches?"general":"lessons")+"Tab");g&&e&&!e.classList.contains("active")&&e.click()}if(g&&n!==o||!g&&n===i)e.push((0,w.Yp)());else if("lessons"===u){s.A.deleteSearchParam("tab"),s.A.removeClass(document.getElementById("lessons"),"active");const e=document.getElementById((B.matches?"general":"meetings")+"Tab");m&&e&&!e.classList.contains("active")&&e.click()}e.length>0&&await Promise.all(e)}catch(e){console.error(e)}if(s.A.bodyPreload(!1),s.A.removeClass(document.getElementById("preloader"),"full-bg"),d.length>0&&d.forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();const t=e.currentTarget,n=t.getAttribute("data-role"),o=n&&"tab"===n?document.querySelector(t.getAttribute("data-target")):t;if(x(o),t.classList.contains("js--go-to-schedule-booking")){const e=document.getElementById("meetingsTab");e&&e.click()}})}),document.addEventListener("click",function(e){for(let t=e.target;t&&t!=this;t=t.parentNode)if((0,r.sb)(t)){if(t.matches("#logoutRequest")){e.preventDefault(),O();break}if(t.matches(".js--trigger-input")){e.preventDefault();const n=t.querySelector("input");if(n){const e=n.getAttribute("type");"checkbox"===e?n.checked=!n.checked:"radio"===e&&(n.checked=!0),(0,r.rC)(n,"change")}break}}}),window.location.search.includes("doneOrder=1")){document.querySelector(".btn--to-payment").click()}e&&s.A.removeClass(document.querySelectorAll(".js--facebook-share-dialog"),"d-none")},j=function(e,t){let n=s.A.getSearchParam("tab");const o=document.querySelector(".js--tab-changes-hide"),a=document.querySelector(".bsapp--main-footer");if(n?B.matches&&"general"!==n?(o&&(o.style.display="none"),s.A.addClass(a,"hidden")):t||"lessons"!==n||(n="meetings"):B.matches?n="general":e?n="meetings":!e&&t&&(n="lessons"),n){const o=document.getElementById(`${n}Tab`);o&&!o.classList.contains("active")&&o.click(),e||s.A.hideTab("meetings"),t||s.A.hideTab("lessons")}window.addEventListener("resize",()=>{const e=s.A.getSearchParam("tab");if(!o)return!1;window.innerWidth<768&&"general"!==e?o.style.display="none":o.style.removeProperty("display")})},x=function(e){const t=e.getAttribute("data-target");if(s.A.setSearchParam("tab",t.replace("#","")),"#meetings"===t){const e=s.A.getCurrentStep(),t=document.querySelectorAll(`[name="${1===e?P:"subscriptionId"}"]:checked`);!t||1!==e&&4!==e||s.A.triggerBottomBar(t.length>0),s.A.removeClass(document.documentElement,"footer-to-bottom"),s.A.setMaxScrolling("meetingsList",1)}else s.A.triggerBottomBar(!1),document.body.clientHeight<window.innerHeight&&s.A.addClass(document.documentElement,"footer-to-bottom");if(B.matches)H(t),"#lessons"===t&&setTimeout(()=>{(0,w.Mk)(),(0,w.j8)(),(0,w.Hq)()},400);else{const e=document.getElementById("infoTab");if(e){const t=e.getBoundingClientRect().top+window.scrollY;Math.floor(t)!==window.scrollY&&setTimeout(()=>{window.scroll({top:t,behavior:"smooth"})},document.body.scrollHeight===window.innerHeight?0:100)}}},H=function(e){const t="#general"===e,n=document.querySelector(".js--tab-changes-hide");if(!n)return!1;const o=document.querySelector(".bsapp--main-footer"),a=document.getElementById("bottomAllowsBooking");if(t)return n.classList.contains("open")||s.A.slideDown(n),s.A.addClass(n,"open"),s.A.removeClass(o,"hidden"),s.A.triggerBottomBar(!0,a),s.A.toggleInfoTab(!0),!1;s.A.addClass(o,"hidden"),s.A.slideUp(n),s.A.removeClass(n,"open"),s.A.triggerBottomBar(!1,a),"meetings"===e&&s.A.toggleInfoTab(1===s.A.getCurrentStep())},O=async function(e=null){s.A.sendFetch(M,{action:"logout"}).then(function(t){if(null!==e)return e(),!1;s.A.getCurrentStep()>2&&(options.helpData.deleteAfterReservationHasPassed=!0,s.A.requestToDeleteReservation(),document.removeEventListener("visibilitychange",()=>{u.u.checkReservationTimer(),(0,I.Wk)()})),(0,l.xL)(null),s.A.updateStep1AndMoveTo(),(0,w.Yp)(),s.A.bodyPreload(!1)})};(0,r.$j)().then(function(){L()})}},e=>{e.O(0,[96,158],()=>{return t=6643,e(e.s=t);var t});e.O()}]);